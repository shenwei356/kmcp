
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="KMCP - K-mer-based Metagenomic Classification and Profiling">
      
      
        <meta name="author" content="Wei Shen">
      
      
        <link rel="canonical" href="https://bioinf.shenwei.me/kmcp/faq/">
      
      <link rel="icon" href="../favicon.svg">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.5">
    
    
      
        <title>FAQs - KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ee0f47ba.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="blue-grey">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#frequently-asked-questions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching" class="md-header__button md-logo" aria-label="KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching" data-md-component="logo">
      
  <img src="../favicon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FAQs
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/shenwei356/kmcp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching" class="md-nav__button md-logo" aria-label="KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching" data-md-component="logo">
      
  <img src="../favicon.svg" alt="logo">

    </a>
    KMCP - accurate metagenomic profiling and fast large-scale sequence/genome searching
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/shenwei356/kmcp/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../download/" class="md-nav__link">
        Download
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../database/" class="md-nav__link">
        Databases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/profiling/" class="md-nav__link">
        Taxonomic profiling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/detecting-pathogens/" class="md-nav__link">
        Detecting specific pathogens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorial/searching/" class="md-nav__link">
        Sequence and genome searching
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Benchmarks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Benchmarks" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Benchmarks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/profiling/" class="md-nav__link">
        Taxonomic profiling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/searching/" class="md-nav__link">
        Sequence and genome searching
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          FAQs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FAQs
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
    <nav class="md-nav" aria-label="General">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#does-kmcp-support-long-read-metagenomic-profiling" class="md-nav__link">
    Does KMCP support long read metagenomic profiling?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-run-kmcp-on-a-computer-without-enough-main-memory" class="md-nav__link">
    How can I run KMCP on a computer without enough main memory?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-building" class="md-nav__link">
    Database building
  </a>
  
    <nav class="md-nav" aria-label="Database building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#can-i-create-a-database-with-custom-genome-collections-for-profiling" class="md-nav__link">
    Can I create a database with custom genome collections for profiling?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-k-mer-size-should-i-use-to-build-the-database" class="md-nav__link">
    What k-mer size should I use to build the database?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-add-new-genomes-to-the-database" class="md-nav__link">
    How to add new genomes to the database?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unexpected-eof-error" class="md-nav__link">
    Unexpected EOF error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-the-elements-in-the-bloom-filters-uniformly-distributed" class="md-nav__link">
    Are the elements in the bloom filters uniformly distributed?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-other-useful-genome-catalogs" class="md-nav__link">
    Some other useful genome catalogs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#searching" class="md-nav__link">
    Searching
  </a>
  
    <nav class="md-nav" aria-label="Searching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-are-the-cpu-usages-are-very-low-not-100" class="md-nav__link">
    Why are the CPU usages are very low, not 100%?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-i-run-multiple-kmcp-processes-in-a-machine" class="md-nav__link">
    Can I run multiple KMCP processes in a machine?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling" class="md-nav__link">
    Profiling
  </a>
  
    <nav class="md-nav" aria-label="Profiling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#where-is-the-taxidmap" class="md-nav__link">
    Where is the taxid.map?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unknown-taxid" class="md-nav__link">
    Unknown taxid?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-tune-parts-of-options-when-using-preset-profiling-modes" class="md-nav__link">
    How to tune parts of options when using preset profiling modes?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/shenwei356" class="md-nav__link">
        More tools
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
    <nav class="md-nav" aria-label="General">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#does-kmcp-support-long-read-metagenomic-profiling" class="md-nav__link">
    Does KMCP support long read metagenomic profiling?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-run-kmcp-on-a-computer-without-enough-main-memory" class="md-nav__link">
    How can I run KMCP on a computer without enough main memory?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-building" class="md-nav__link">
    Database building
  </a>
  
    <nav class="md-nav" aria-label="Database building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#can-i-create-a-database-with-custom-genome-collections-for-profiling" class="md-nav__link">
    Can I create a database with custom genome collections for profiling?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-k-mer-size-should-i-use-to-build-the-database" class="md-nav__link">
    What k-mer size should I use to build the database?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-add-new-genomes-to-the-database" class="md-nav__link">
    How to add new genomes to the database?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unexpected-eof-error" class="md-nav__link">
    Unexpected EOF error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-the-elements-in-the-bloom-filters-uniformly-distributed" class="md-nav__link">
    Are the elements in the bloom filters uniformly distributed?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-other-useful-genome-catalogs" class="md-nav__link">
    Some other useful genome catalogs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#searching" class="md-nav__link">
    Searching
  </a>
  
    <nav class="md-nav" aria-label="Searching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-are-the-cpu-usages-are-very-low-not-100" class="md-nav__link">
    Why are the CPU usages are very low, not 100%?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-i-run-multiple-kmcp-processes-in-a-machine" class="md-nav__link">
    Can I run multiple KMCP processes in a machine?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling" class="md-nav__link">
    Profiling
  </a>
  
    <nav class="md-nav" aria-label="Profiling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#where-is-the-taxidmap" class="md-nav__link">
    Where is the taxid.map?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unknown-taxid" class="md-nav__link">
    Unknown taxid?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-tune-parts-of-options-when-using-preset-profiling-modes" class="md-nav__link">
    How to tune parts of options when using preset profiling modes?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/shenwei356/kmcp/edit/master/docs/faq.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="frequently-asked-questions">Frequently Asked Questions</h1>
<h2 id="general">General</h2>
<h3 id="does-kmcp-support-long-read-metagenomic-profiling">Does KMCP support long read metagenomic profiling?</h3>
<p>Note: This was asked <a href="https://github.com/shenwei356/kmcp/issues/27">here</a>.</p>
<p>KMCP is only suitable for short-read metagenomic profiling, with much lower sensitivity on long-read datasets.
My initial plan was to support both short and long reads. But the read matching strategy, i.e., keeping reads
with enough (&gt;= 55% by default) k-mers contained in a genome chunk, is of low sensitivity for long reads, even for HIFI reads.</p>
<p>Some strategies were tried, but the results were out of expectation.</p>
<ol>
<li>Setting a lower similarity threshold. For our probabilistic data structure,
   lower thresholds will significantly increase the false-positive rates of a read,
   though the FPR can also be reduced at the cost of bigger databases.</li>
<li>Using sketching algorithm. ScaledMinash, Closed Syncmers, and Minimizer were all implemented
   (available in the current version) and tested, but they didn't work well on error-prone long
   reads with lower sensitivity. Though tools like minimap2 benefit from Minimizer with location
   information for seeding and chaining in sequence alignment, we failed to utilize them in taxonomic profiling.</li>
<li>Using multiple k-mers. K-mers of different lengths, e.g., 17, 21, 31, didn't do better than
   a single value and doubled the database size.</li>
<li>Using Simhash with a higher tolerance than k-mer on base substitution.
   It's slower and has a lower sensitivity unexpectedly.</li>
<li>Breaking long reads into short fragments.
   It only applies to HIFI  reads, but the strength of the long reads is wasted.</li>
</ol>
<h3 id="how-can-i-run-kmcp-on-a-computer-without-enough-main-memory">How can I run KMCP on a computer without enough main memory?</h3>
<p>By default, <code>kmcp search</code> loads the whole database into main memory (RAM) for fast searching.
Optionally, the flag <code>--low-mem</code> can be set to avoid loading the whole database,
while it's much slower, &gt;10X slower on SSD and should be much slower on HDD disks.</p>
<p>Another way is dividing the reference genomes into several parts
and building smaller databases for all parts, so that the biggest
database can be loaded into RAM. After performing database searching,
search results on all small databases can be merged with <code>kmcp merge</code>
for downstream analysis.</p>
<p>Buiding small databases can also accelerate searching on a <em>computer cluster</em>,
where every node searches a part of the database.</p>
<h2 id="database-building">Database building</h2>
<h3 id="can-i-create-a-database-with-custom-genome-collections-for-profiling">Can I create a database with custom genome collections for profiling?</h3>
<p>Yes, you can use <a href="https://bioinf.shenwei.me/taxonkit/usage/#create-taxdump">taxonkit create-taxdump</a>
to create NCBI-style taxdump files for profiling, which also generates a <code>taxid.map</code> file.</p>
<h3 id="what-k-mer-size-should-i-use-to-build-the-database">What k-mer size should I use to build the database?</h3>
<p>Multiple k-mer sizes are supported, but one value is good enough.
And the K needs to be equal or less than 64, due to <a href="https://github.com/bcgsc/ntHash/issues/41">the bug of older versions of ntHash</a>.</p>
<p>Bigger k-mer sizes bring high specificity at the cost of decrease
of sensitivity. <code>k = 21</code> is recommended for metagenomic profiling.</p>
<h3 id="how-to-add-new-genomes-to-the-database">How to add new genomes to the database?</h3>
<p>KMCP builds database very fast,
you can either rebuilt the database after adding new genomes,
or create a separate database with the new genomes,
search against these databases, and <a href="/kmcp/usage/#merge">merge</a> the results.</p>
<h3 id="unexpected-eof-error">Unexpected EOF error</h3>
<p>Some files could corrupt during downloading, we recommend checking
sequence file integrity using seqkit (<code>gzip -t</code> failed for some files in
my tests).</p>
<ol>
<li>
<p>List corrupted files</p>
<pre><code># corrupted files
find $genomes -name "*.gz" \
    | rush 'seqkit seq -w 0 {} &gt; /dev/null; if [ $? -ne 0 ]; then echo {}; fi' \
    &gt; failed.txt

# empty files
find $genomes -name "*.gz" -size 0 &gt;&gt; failed.txt
</code></pre>
</li>
<li>
<p>Delete these files:</p>
<pre><code>cat failed.txt | rush '/bin/rm {}'
</code></pre>
</li>
<li>
<p>Redownload these files. For example, from <code>rush</code> cache file <code>download.rush</code> (list of succeed commands), where the commands are in one line.</p>
<pre><code>grep -f failed.txt download.rush \
    | sed 's/__CMD__//g' \
    | rush '{}'
</code></pre>
<p>For <code>genome_updater</code>, URLs of genomes can be found in files like <code>2021-09-30_13-32-30_url_downloaded.txt</code>, 
you can extract URLs using <code>grep -f failed.txt -v *url_downloaded.txt</code> or some other ways,
and batch redownload them using <code>parallel</code>.</p>
</li>
</ol>
<h3 id="are-the-elements-in-the-bloom-filters-uniformly-distributed">Are the elements in the bloom filters uniformly distributed?</h3>
<p>Someone asked me this when I was giving a talk on KMCP. The answer is yes.</p>
<p>I created a new command <a href="https://bioinf.shenwei.me/kmcp/usage/#index-density"><code>kmcp utils index-density</code></a> to plot the density of a index file.</p>
<p>In the image,</p>
<ul>
<li>X: bins. The width is the number of bins</li>
<li>Y: bloom filters, with each representing a genome (chunk).
The height is the number of names (genome or genome chunks)</li>
<li>greyscale/darkness of a pixel: the density of a bin, calculated as:
    255 - 255 * ${the number of 1s in the bin} / ${bin-size}</li>
</ul>
<p>Here's are some example outputs.</p>
<ol>
<li>
<p>v2023.05-genbank-viral-_block001.uniki (FPR of bloom filter: 0.3), only a part of image is shown.</p>
<p><img alt="" src="../v2023.05-genbank-viral-_block001.uniki.part.jpg" /></p>
<p>Note that the genome sizes (base pairs) of this genome chunk vary widely, so the densities of the preceding bloom files are relatively spare.</p>
<p>Information of k-mers:</p>
<pre><code>kmcp utils ref-info -d genbank-viral.kmcp \
    | csvtk grep -t -p _block001.uniki \
    | csvtk cut -t -f -2 \
    | csvtk head -n 10 \
    | csvtk csv2md -t
</code></pre>
<table>
<thead>
<tr>
<th align="left">file</th>
<th align="left">target</th>
<th align="left">chunkIdx</th>
<th align="left">chunks</th>
<th align="left">kmers</th>
<th align="left">fpr</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_008766775.1</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">145</td>
<td align="left">0.022419</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_003330005.1</td>
<td align="left">8</td>
<td align="left">10</td>
<td align="left">150</td>
<td align="left">0.023183</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_002814895.1</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">154</td>
<td align="left">0.023794</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_001967255.1</td>
<td align="left">9</td>
<td align="left">10</td>
<td align="left">165</td>
<td align="left">0.025471</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_002219745.1</td>
<td align="left">4</td>
<td align="left">10</td>
<td align="left">197</td>
<td align="left">0.030336</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_000839085.1</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">200</td>
<td align="left">0.030790</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_000919055.1</td>
<td align="left">9</td>
<td align="left">10</td>
<td align="left">207</td>
<td align="left">0.031851</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_000848385.1</td>
<td align="left">6</td>
<td align="left">10</td>
<td align="left">207</td>
<td align="left">0.031851</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_002820565.1</td>
<td align="left">9</td>
<td align="left">10</td>
<td align="left">208</td>
<td align="left">0.032002</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCA_002820505.1</td>
<td align="left">9</td>
<td align="left">10</td>
<td align="left">208</td>
<td align="left">0.032002</td>
</tr>
</tbody>
</table>
<p>Information of bloom filters:</p>
<pre><code>kmcp utils index-info -b genbank-viral.kmcp/R001/_block001.uniki | csvtk csv2md -t
</code></pre>
<table>
<thead>
<tr>
<th align="left">file</th>
<th align="left">k</th>
<th align="left">canonical</th>
<th align="left">num-hashes</th>
<th align="left">num-sigs</th>
<th align="left">num-names</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">21</td>
<td align="left">true</td>
<td align="left">1</td>
<td align="left">6395</td>
<td align="left">10400</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>v2023.05-refseq-fungi-_block001.uniki (FPR of bloom filter: 0.3)</p>
<p><img alt="" src="../v2023.05-refseq-fungi-_block001.uniki.jpg" /></p>
<p>Information of k-mers:</p>
<pre><code>kmcp utils ref-info -d refseq-fungi.kmcp \
    | csvtk grep -t -p _block001.uniki \
    | csvtk cut -t -f -2 \
    | csvtk head -n 10 \
    | csvtk csv2md -t
</code></pre>
<table>
<thead>
<tr>
<th align="left">file</th>
<th align="left">target</th>
<th align="left">chunkIdx</th>
<th align="left">chunks</th>
<th align="left">kmers</th>
<th align="left">fpr</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000277815.2</td>
<td align="left">0</td>
<td align="left">10</td>
<td align="left">207084</td>
<td align="left">0.094334</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000146465.1</td>
<td align="left">0</td>
<td align="left">10</td>
<td align="left">209422</td>
<td align="left">0.095346</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000091225.2</td>
<td align="left">0</td>
<td align="left">10</td>
<td align="left">209787</td>
<td align="left">0.095504</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">8</td>
<td align="left">10</td>
<td align="left">216972</td>
<td align="left">0.098608</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">9</td>
<td align="left">10</td>
<td align="left">217529</td>
<td align="left">0.098849</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">3</td>
<td align="left">10</td>
<td align="left">217631</td>
<td align="left">0.098892</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">6</td>
<td align="left">10</td>
<td align="left">218560</td>
<td align="left">0.099293</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">7</td>
<td align="left">10</td>
<td align="left">218763</td>
<td align="left">0.099380</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">4</td>
<td align="left">10</td>
<td align="left">218830</td>
<td align="left">0.099409</td>
</tr>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">GCF_000280035.1</td>
<td align="left">0</td>
<td align="left">10</td>
<td align="left">218860</td>
<td align="left">0.099422</td>
</tr>
</tbody>
</table>
<p>Information of bloom filters:</p>
<pre><code>kmcp utils index-info -b refseq-fungi.kmcp/R001/_block001.uniki | csvtk csv2md -t
</code></pre>
<table>
<thead>
<tr>
<th align="left">file</th>
<th align="left">k</th>
<th align="left">canonical</th>
<th align="left">num-hashes</th>
<th align="left">num-sigs</th>
<th align="left">num-names</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">_block001.uniki</td>
<td align="left">21</td>
<td align="left">true</td>
<td align="left">1</td>
<td align="left">2089979</td>
<td align="left">160</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>v2023.05-refseq-fungi-_block002.uniki (FPR of bloom filter: 0.3)</p>
<p><img alt="" src="../v2023.05-refseq-fungi-_block002.uniki.jpg" /></p>
<table>
<thead>
<tr>
<th align="left">file</th>
<th align="left">target</th>
<th align="left">chunkIdx</th>
<th align="left">chunks</th>
<th align="left">kmers</th>
<th align="left">fpr</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_000349005.2</td>
<td align="left">5</td>
<td align="left">10</td>
<td align="left">745638</td>
<td align="left">0.249355</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_000349005.2</td>
<td align="left">2</td>
<td align="left">10</td>
<td align="left">746237</td>
<td align="left">0.249528</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_000349005.2</td>
<td align="left">9</td>
<td align="left">10</td>
<td align="left">747586</td>
<td align="left">0.249917</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_000349005.2</td>
<td align="left">0</td>
<td align="left">10</td>
<td align="left">748331</td>
<td align="left">0.250132</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_000349005.2</td>
<td align="left">7</td>
<td align="left">10</td>
<td align="left">749497</td>
<td align="left">0.250469</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_001477545.1</td>
<td align="left">5</td>
<td align="left">10</td>
<td align="left">751685</td>
<td align="left">0.251099</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_002251995.1</td>
<td align="left">3</td>
<td align="left">10</td>
<td align="left">753439</td>
<td align="left">0.251604</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_001477545.1</td>
<td align="left">4</td>
<td align="left">10</td>
<td align="left">755317</td>
<td align="left">0.252145</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_001477545.1</td>
<td align="left">0</td>
<td align="left">10</td>
<td align="left">758418</td>
<td align="left">0.253036</td>
</tr>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">GCF_001477545.1</td>
<td align="left">8</td>
<td align="left">10</td>
<td align="left">760460</td>
<td align="left">0.253623</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="left">file</th>
<th align="left">k</th>
<th align="left">canonical</th>
<th align="left">num-hashes</th>
<th align="left">num-sigs</th>
<th align="left">num-names</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">_block002.uniki</td>
<td align="left">21</td>
<td align="left">true</td>
<td align="left">1</td>
<td align="left">2599648</td>
<td align="left">160</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h2 id="some-other-useful-genome-catalogs">Some other useful genome catalogs</h2>
<ul>
<li><a href="https://parasite.wormbase.org/index.html">WormBase ParaSite</a></li>
</ul>
<h2 id="searching">Searching</h2>
<h3 id="why-are-the-cpu-usages-are-very-low-not-100">Why are the CPU usages are very low, not 100%?</h3>
<p>Please check the log (in terminal not the log file via the option <code>--log</code>),
it should report current searching speed, like:</p>
<pre><code>21:07:42.949 [INFO] reading sequence file: t_t3.fa.gz
processed queries: 1253376, speed: 8.127 million queries per minute
</code></pre>
<p>If the speed is very slow. </p>
<ul>
<li>
<p>Are you running KMCP in a computer cluster (HPC)? </p>
<ul>
<li>If yes, please switch on <code>-w/--load-whole-db</code>.
  Because the default database loading mode would be very slow for network-attached storage (NAS).</li>
</ul>
</li>
<li>
<p>Are the reference genomes are highly similar? E.g., tens of thousands of genomes of a same species?</p>
<ul>
<li>If yes, check the search result to see if there are thousands of matches for a read.
  You may choose another graph-based sequence searching tool.</li>
</ul>
</li>
<li>
<p>Are you searching with metatranscriptomics data?</p>
<ul>
<li>If yes, the search results would show that a huge number of reads from 16 rRNA genes have thousands of matches,
  therefore, writing results slow down the search.
  So these reads should be filtered out before the search using tools like https://github.com/hzi-bifo/RiboDetector.</li>
</ul>
</li>
</ul>
<h3 id="can-i-run-multiple-kmcp-processes-in-a-machine">Can I run multiple KMCP processes in a machine?</h3>
<p>Yes you can. But note that KMCP search is CPU- and RAM-intense. So please to <strong>limit the number of CPUs cores to use for each process</strong> with the falg <code>-j/--threads</code>, of which the default value is the available CPUs cores of the machine.</p>
<h2 id="profiling">Profiling</h2>
<h3 id="where-is-the-taxidmap">Where is the taxid.map?</h3>
<p>Each prebuilt database contains a <code>taxid.map</code> file in its directory.
You can concatenate them into a big one:</p>
<pre><code>$ cat gtdb.kmcp/taxid.map refseq-viral.kmcp/taxid.map refseq-fungi.kmcp/taxid.map &gt; taxid.map

$ head -n 5 taxid.map
GCA_004025655.1 10243
GCA_004025395.1 10243
GCA_004025355.1 10243
GCA_003971405.1 10243
GCA_003971385.1 10243
</code></pre>
<p>Or set the options <code>-T/--taxid-map</code> multiple times:</p>
<pre><code>kmcp profile -T gtdb.kmcp/taxid.map -T refseq-viral.kmcp/taxid.map -T refseq-fungi.kmcp/taxid.map ...
</code></pre>
<p>For other custom genome collections, you can use
<a href="https://bioinf.shenwei.me/taxonkit/usage/#create-taxdump">taxonkit create-taxdump</a>
to create NCBI-style taxdump files for custom taxonomy, e.g.,
<a href="https://github.com/shenwei356/gtdb-taxdump">GTDB</a> and
<a href="https://github.com/shenwei356/ictv-taxdump">ICTV</a>, which also generates a <code>taxid.map</code> file.</p>
<h3 id="unknown-taxid">Unknown taxid?</h3>
<blockquote>
<p>19:54:54.632 [ERRO] unknown taxid for NZ_CP028116.1, please check taxid mapping file(s)</p>
</blockquote>
<p>If the <code>kmcp profile</code> reports this, you may need to check if the taxid mapping file contain all the reference IDs.
And make sure the reference IDs match these in the database, the later ones are listed in: </p>
<pre><code>$ head -n 5 $kmcp_db_dir/R001/__name_mapping.tsv
NC_013654.1     NC_013654.1
NC_000913.3     NC_000913.3
NC_010655.1     NC_010655.1
NC_012971.2     NC_012971.2
NC_011750.1     NC_011750.1
</code></pre>
<p>There's another case: you used <code>--name-map</code> in <code>kmcp search</code>.
Please don't do this if you will use the search result for metagenomic
profiling which needs the original reference IDs. We add a note now:</p>
<pre><code>-N, --name-map strings  ► Tabular two-column file(s) mapping reference IDs to user-defined
                        values. Don't use this if you will use the result for metagenomic
                        profiling which needs the original reference IDs.

</code></pre>
<h3 id="how-to-tune-parts-of-options-when-using-preset-profiling-modes">How to tune parts of options when using preset profiling modes?</h3>
<p><s>Sorry it's not supported due to the limitation of the command-line argument parsers.
You need explicitly set all relevant options of the mode.</s></p>
<p>It's available since v0.8.2.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../benchmark/searching/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Sequence and genome searching" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Sequence and genome searching
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.b6ff8c07.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.5e13d264.min.js"></script>
      
    
  </body>
</html>